---
title: "Inferencia utilizando técnicas de remuestreo: el Bootstrap"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_float: true
  pdf_document:
    number_sections: true
    toc: true
---

# Introducción

El bootstrap es un método para estimar varianzas de estadísticos e intervalos de confianza mediante el remuestreo de los datos disponibles.

## Estimación de la varianza con bootstrap

Sea $\{X_1, X_2, \cdots,X_n\}$ una muestra aleatoria simple (luego los datos son independientes y con igual distribución). Y sea $T = f(X_1, X_2, \cdots,X_n)$ un estadístico, es decir, $T$ es cualquier función de los datos. Para calcular la varianza del estimador, $Var(T)$, el método bootstrap consiste en:

- Paso 1: generar, mediante simulación, una muestra con reemplazamiento a partir de $\{X_1, X_2, \cdots,X_n\}$ que llamaremos $\{X_1^*, X_2^*, \cdots,X_n^*\}$.
- Paso 2: Calcular la estimación de $T$ a partir de la muestra bootstrap: $T^* = f(X_1^*, X_2^*, \cdots,X_n^*)$.
- Paso 3: Repetir los pasos 1 y 2 un total de B veces, obteniendo $T_1^{*},T_2^{*}, \ldots,T_B^{*}$.
- Paso 4: estimar la varianza de $T$ mediante la varianza de $T_1^{*},T_2^{*}, \ldots,T_B^{*}$.


# Estimación de intervalos de confianza utilizando bootstrap

Hay varios métodos para calcular el intervalo de confianza de un parámetro $\theta$ con bootstrap. Nosotros vamos a utilizar el método de los percentiles:

- Paso 1: generar, mediante simulación, una muestra con reemplazamiento a partir de $\{X_1, X_2, \cdots,X_n\}$ que llamaremos $\{X_1^*, X_2^*, \cdots,X_n^*\}$.
- Paso 2: Calcular la estimación de $\theta$ a partir de la muestra bootstrap: $\theta^* = T(X_1^*, X_2^*, \cdots,X_n^*)$.
- Paso 3: Repetir los pasos 1 y 2 un total de B veces, obteniendo $\theta_1^{*},\theta_2^{*}, \ldots,\theta_B^{*}$.
- Paso 4: estimar el intervalo de $\theta$ mediante $(\theta_{\alpha/2}^{*},\theta_{1-\alpha/2}^{*})$.


# Bootstrap en el modelo de regresión

En un problema de regresión la muestra consiste en:

$$
(y_1, x_{11}, x_{21}, \cdots, x_{k1})
$$

$$
(y_2, x_{12}, x_{22}, \cdots, x_{k2})
$$

$$
\cdots
$$

$$
(y_n, x_{1n}, x_{2n}, \cdots, x_{kn})
$$

Para el modelo de regresión el método bootstrap consiste en:

- Paso 1: generar una muestra con reemplazamiento de los pares de datos que llamaremos $\{(y_1^*,x_{11}^*,x_{21}^*, \ldots,x_{k1}^*), (y_2^*,x_{12}^*,x_{22}^*, \ldots,x_{k2}^*), \cdots, (y_n^*,x_{1n}^*,x_{2n}^*, \ldots,x_{kn}^*) \}$.
- Paso 2: estimar los parámetros del modelo a partir de la muestra bootstrap $y^* = X^* \hat \beta^* + e^*$.
- Paso 3: Repetir los pasos 1 y 2 un total de B veces, obteniendo $\beta_1^{*},\beta_2^{*}, \ldots,\beta_B^{*}$.
- Paso 4: calcular la varianza de los estimadores o los intervalos de confianza de los parámetros a partir de los valores calculados en el paso 3.

Por ejemplo, vamos a calcular la varianza de los estimadores y los intervalos de confianza para el modelo:

```{r}
load("datos/kidiq.Rdata")
str(d)
```

```{r}
# estimamos los parametros del modelo
m1 = lm(kid_score ~ mom_iq + mom_hs, data = d)
beta_e = coef(m1)
```

```{r}
# BOOTSTRAP
# muestreamos los datos CON REPOSICION
n = nrow(d)
B = 1000
beta_e_b = matrix(0, nrow = B, ncol = 3)
for (i in 1:B){
  pos = sample(1:n, rep = T)
  db = d[pos,]
  mb = lm(kid_score ~ mom_iq + mom_hs, data = db)
  beta_e_b[i,] = coef(mb)
}
```

- Varianza de los parémetros estimados

```{r}
# aplicando la teoría
diag(vcov(m1))
# aplicando bootstrap
apply(beta_e_b, 2, var)
```

- intervalos de confianza

```{r}
# aplicando la teoría
confint(m1)
# aplicando bootstrap
t(apply(beta_e_b, 2, quantile, probs = c(0.025,0.975)))
```

