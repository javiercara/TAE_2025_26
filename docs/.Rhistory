abline(a = m$coef[1], b = m$coef[2], col = "blue")
# modelo para secundaria_si = 1
abline(a = m$coef[1] + m$coef[3], b = m$coef[2], col = "red")
m = lm(kid_score ~ mom_iq + mom_hs, data = d)
summary(m)
levels(d$mom_hs)
contrasts(d$mom_hs)
secundaria_no = ifelse(d$mom_hs == "no", 1, 0)
m = lm(kid_score ~ mom_iq + secundaria_no, data = d)
coef(m)
levels(d$mom_hs)
contrasts(d$mom_hs)
d$mom_hs1 = relevel(d$mom_hs, ref = "si")
levels(d$mom_hs1)
contrasts(d$mom_hs1)
m = lm(kid_score ~ mom_iq + mom_hs1, data = d)
summary(m)
m = lm(kid_score ~ 0 + mom_iq + secundaria_si + secundaria_no, data = d)
summary(m)
m = lm(kid_score ~ 0 + mom_iq + mom_hs, data = d)
summary(m)
levels(d$mom_work)
notrabaja_si = ifelse(d$mom_work == "notrabaja", 1, 0)
trabaja23_si = ifelse(d$mom_work == "trabaja23", 1, 0)
trabaja1p_si = ifelse(d$mom_work == "trabaja1p", 1, 0)
trabaja1c_si = ifelse(d$mom_work == "trabaja1c", 1, 0)
m = lm(kid_score ~ mom_iq + trabaja23_si + trabaja1p_si + trabaja1c_si, data = d)
summary(m)
m = lm(kid_score ~ mom_iq + mom_work, data = d)
summary(m)
knitr::opts_chunk$set(echo = TRUE)
load("datos/kidiq.Rdata")
str(d)
knitr::opts_chunk$set(echo = TRUE)
load("datos/kidiq.Rdata")
load("datos/kidiq.Rdata")
str(d)
m1 = lm(kid_score ~ . - mom_work, data = d)
summary(m1)
# render the whole dir
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print(files[ii])
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
# render the whole dir
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print(files[ii])
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
# render the whole dir
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print(files[ii])
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
files[ii]
# render the whole dir
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print(files[ii])
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
# render the whole dir
files = dir()
files
ii= 10
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
files[ii]
# render the whole dir
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print(files[ii])
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
# render the whole dir
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
xp = data.frame(
long_pico = c(39.8,46.1),
prof_pico = c(18.4,15.5),
long_aleta = c(192,202),
peso = c(3250,4000),
isla = c("Dream","Biscoe"),
genero = c("hembra","macho")
)
xp
## se leen los datos
d = read.csv("datos/pinguinos.csv", sep = ";")
# es conveniente convertir a factores las variables cualitativas
d$especie = factor(d$especie)
d$isla = factor(d$isla)
d$genero = factor(d$genero)
# se lee la funcion que normaliza
source("funciones/knn_funciones.R")
# se normalizan y se guardan en un data.frame
d1 = data.frame(
long_pico = knn_normaliza(d$long_pico),
prof_pico = knn_normaliza(d$prof_pico),
long_aleta = knn_normaliza(d$long_aleta),
peso = knn_normaliza(d$peso)
)
#
d1$isla_Bis = ifelse(d$isla == "Biscoe", 1, 0)
d1$isla_Dre = ifelse(d$isla == "Dream", 1, 0)
#
d1$genero_H = ifelse(d$genero == "hembra", 1, 0)
# variables cuantitativas normalizadas
xp1 = data.frame(
long_pico = knn_normaliza(c(39.8,46.1), min(d$long_pico), max(d$long_pico)),
prof_pico = knn_normaliza(c(18.4,15.5), min(d$prof_pico), max(d$prof_pico)),
long_aleta = knn_normaliza(c(192,202), min(d$long_aleta), max(d$long_aleta)),
peso = knn_normaliza(c(3250,4000), min(d$peso), max(d$peso))
)
# variables auxiliares
xp1$isla_Bis = c(0,1)
xp1$isla_Dre = c(1,0)
#
xp1$genero_H = c(1,0)
# se utiliza la funcion knn.reg del paquete FNN
yp = FNN::knn(d1, test = xp1, cl = d$especie, k = 3)
yp
# la especie de los k puntos m√°s cercanos es
(p1 = attr(yp,"nn.index")[1,])
d$especie[p1]
# se crean los datos de entrenamiento y los datos test (80%-20%)
set.seed(678)
n = nrow(d)
pos_train = sample(1:n,round(0.8*n), replace = F)
train_x = d1[pos_train,]
test_x = d1[-pos_train,]
train_y = d$especie[pos_train]
test_y = d$especie[-pos_train]
# se utiliza la funcion knn.reg del paquete FNN
yp = FNN::knn(train_x, test = test_x, cl = train_y, k = 1)
# matriz de confusion
(t = table(test_y, yp))
# error
1 - sum(diag(t))/sum(t)
plot(d$long_pico, d$prof_pico, col = d$especie, pch = 19)
legend("bottomright", legend = c("Adelie","Chindstrap","Gentoo"), pch = 19, col = 1:3)
# se utilizan todos los datos
(yp = FNN::knn(d1, test = xp1, cl = d$especie, k = 1))
yp=FNN::knn.cv(train_x,train_y, k = 3)
str(yp)
(t = table(train_y,yp))
error = rep(0,20)
for (ii in 1:20){
yp = FNN::knn.cv(train_x,train_y, k = ii)
t = table(train_y,yp)
error[ii] = 1 - sum(diag(t))/sum(t)
}
plot(1:20,error, type = "b")
# render the whole dir
rm(list = ls())
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(ii,files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(ii)
print(files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
for (ii in 11:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(ii)
print(files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
for (ii in 19:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(ii)
print(files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
# render the whole dir
rm(list = ls())
files = dir()
for (ii in 18:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(ii)
print(files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
# render the whole dir
rm(list = ls())
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(ii)
print(files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
d = read.csv("datos/MichelinNY.csv")
m1 = glm(InMichelin ~ Food + Decor + Service + Price, data = d, family = binomial)
summary(m1)
xp = c(1,22,25,24,75)
beta_e = coef(m1)
( pi_p = exp(t(xp) %*% beta_e)/(1 + exp(t(xp) %*% beta_e)) )
source("funciones/logit_funciones.R")
H = logit_hess(coef(m1),model.matrix(m1))
xp = matrix(xp, ncol = 1)
(se = sqrt(- t(xp) %*% solve(H) %*% xp ))
alfa = 0.05
Lp = t(xp) %*% beta_e - qnorm(1-alfa/2)*se
Up = t(xp) %*% beta_e + qnorm(1-alfa/2)*se
# limite inferior intrevalo confianza
exp(Lp)/(1+exp(Lp))
# limite superior intrevalo confianza
exp(Up)/(1+exp(Up))
xp_df = data.frame(Food = 22, Decor = 25, Service = 24, Price = 75)
(pred = predict(m1, newdata = xp_df, type = "response"))
(pred = predict(m1, newdata = xp_df, type = "response", se.fit = T))
alfa = 0.05
# limite inferior intervalo confianza
pred$fit - qnorm(1-alfa/2)*pred$se.fit
# limite superior intervalo confianza
pred$fit + qnorm(1-alfa/2)*pred$se.fit
(pred = predict(m1, newdata = xp_df, type = "link", se.fit = T))
alfa = 0.05
Lp = pred$fit - qnorm(1-alfa/2)*pred$se.fit
Up = pred$fit + qnorm(1-alfa/2)*pred$se.fit
# limite inferior intervalo confianza
exp(Lp)/(1+exp(Lp))
# limite superior intervalo confianza
exp(Up)/(1+exp(Up))
set.seed(567)
B = 500
n = nrow(d)
yp = rep(0,B)
for (b in 1:B){
# remuestrear datos
posb = sample(1:n, replace = T)
db = d[pos_b,]
# estimar modelo b
mb = glm(InMichelin ~ Food + Decor + Service + Price,
data = db,family = binomial)
# se guarda la prediccion
yp[b] = predict(mb, newdata = df, type = "response")
}
set.seed(567)
B = 500
n = nrow(d)
yp = rep(0,B)
for (b in 1:B){
# remuestrear datos
posb = sample(1:n, replace = T)
db = d[posb,]
# estimar modelo b
mb = glm(InMichelin ~ Food + Decor + Service + Price,
data = db,family = binomial)
# se guarda la prediccion
yp[b] = predict(mb, newdata = df, type = "response")
}
set.seed(567)
B = 500
n = nrow(d)
yp = rep(0,B)
for (b in 1:B){
# remuestrear datos
posb = sample(1:n, replace = T)
db = d[posb,]
# estimar modelo b
mb = glm(InMichelin ~ Food + Decor + Service + Price,
data = db,family = binomial)
# se guarda la prediccion
yp[b] = predict(mb, newdata = xp_df, type = "response")
}
sd(yp)
quantile(yp, probs = c(alfa/2,1-alfa/2))
mean(yp)
median(yp)
# render the whole dir
rm(list = ls())
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(ii)
print(files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
# render the whole dir
rm(list = ls())
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(ii)
print(files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
# render the whole dir
rm(list = ls())
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(ii)
print(files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
d = read.csv("datos/MichelinNY.csv")
str(d)
logit_logL = function(beta,y,X){
# asumimos que beta es un vector
# beta = [beta0 beta1 .. betak]
# y = [y1 y2 ... yn]
# X es la matriz de regresores
n = length(y)
suma = 0
for (i in 1:n){
suma = suma + y[i]*sum(X[i,]*beta) -
log(1 + exp( sum(t(X[i,])*beta) ))
}
return(suma)
}
beta = c(-2,0.05,0.05,0.05,0.05)
X = cbind(rep(1,nrow(d)), d[,3:6])
logit_logL(beta,d$InMichelin,X)
logit_grad = function(beta,y,X){
X = as.matrix(X)
n = length(y)
y = matrix(y, nrow = n, ncol = 1)
pi = matrix(0, nrow = n, ncol = 1)
for (i in 1:n){
pi[i,1] = exp(sum(X[i,]*beta))/(1 + exp(sum(X[i,]*beta)))
}
grad = t(X) %*% (y - pi)
return(grad)
}
beta = c(-2,0.05,0.05,0.05,0.05)
X = cbind(rep(1,nrow(d)), d[,3:6])
logit_grad(beta, d$InMichelin, X)
logit_hess = function(beta,X){
X = as.matrix(X)
n = nrow(X)
W = matrix(0, nrow = n, ncol = n)
for (i in 1:n){
pi = exp(sum(X[i,]*beta))/(1 + exp(sum(X[i,]*beta)))
W[i,i] = pi*(1-pi)
}
hess = - t(X) %*% W %*% X
return(hess)
}
beta = c(-2,0.05,0.05,0.05,0.05)
X = cbind(rep(1,nrow(d)), d[,3:6])
logit_hess(beta, X)
nlme::fdHess(beta,logit_logL, y = d$InMichelin, X)
logit_Newton = function(beta_i, y, X, max_iter = 100, tol = 10^(-6), alfa = 0.1){
# punto de partida
beta = beta_i
iter = 1
tol1 = Inf
while ((iter <= max_iter) & (tol1 > tol)){
f = logit_logL(beta,y,X)
grad = logit_grad(beta,y,X)
hess = logit_hess(beta,X)
beta = beta - alfa*solve(hess) %*% grad
f1 = logit_logL(beta,y,X)
tol1 = abs((f1-f)/f)
print(paste("Iteracion ",iter," log-verosimilitud ",f1))
iter = iter + 1
}
return(beta)
}
m = lm(InMichelin ~ Food + Decor + Service + Price, data = d)
beta_i = coef(m)
X = cbind(rep(1,nrow(d)), d[,3:6])
logit_Newton(beta_i,d$InMichelin,X)
logit_logL_optim = function(beta,y,X){
logL = logit_logL(beta,y,X)
return(-logL)
}
mle = optim(par = beta_i, fn = logit_logL_optim, y = d$InMichelin, X = X, gr = logit_grad, method = "BFGS", hessian = TRUE, control = list(trace=1, REPORT = 1, maxit = 200))
mle$par
logit_logL_nlm = function(beta,y,X){
res = -logit_logL(beta,y,X)
attr(res,"gradient") = logit_grad(beta,y,X)
attr(res,"hessian") = logit_hess(beta,X)
return(res)
}
mle = nlm(f = logit_logL_nlm, p = beta_i, y = d$InMichelin, X = X)
m2 = glm(InMichelin ~ Food + Decor + Service + Price, data = d, family = binomial)
summary(m2)
logit_logL_optim = function(beta,y,X){
logL = logit_logL(beta,y,X)
return(-logL)
}
mle = optim(par = beta_i, fn = logit_logL_optim, y = d$InMichelin, X = X, gr = logit_grad, method = "BFGS", hessian = TRUE, control = list(trace=1, REPORT = 1, maxit = 200))
mle$par
mle = optim(par = beta_i, fn = logit_logL_optim, y = d$InMichelin, X = X, gr = NULL, method = "BFGS", hessian = TRUE, control = list(trace=1, REPORT = 1, maxit = 200))
mle$par
# render the whole dir
rm(list = ls())
files = dir()
for (ii in 1:length(files)){
file1 = substr(files[ii],nchar(files[ii])-2,nchar(files[ii]))
if (file1 == "Rmd"){
print("*****************************")
print(ii)
print(files[ii])
print("*****************************")
#rmarkdown::render(file1)
rmarkdown::render(input = files[ii], output_format = "html_document")
rmarkdown::render(input = files[ii], output_format = "pdf_document")
}
}
load("datos/kidiq.Rdata")
levels(d$mom_work)
